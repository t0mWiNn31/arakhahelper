<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arakha Community</title>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    <style>
        #matrix-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; }
        body { background: #000; color: #ccc; font-family: sans-serif; margin: 0; overflow-x: hidden; }
        .nav { background: rgba(17, 17, 17, 0.9); backdrop-filter: blur(10px); padding: 10px 15px; border-bottom: 1px solid #00ff41; position: sticky; top: 0; z-index: 100; }
        .nav-top { display: flex; justify-content: space-between; align-items: center; }
        .container { max-width: 700px; margin: 20px auto; padding: 10px; position: relative; z-index: 1; }
        .post-input { background: rgba(17, 17, 17, 0.85); padding: 20px; border: 1px solid #00ff41; margin-bottom: 20px; border-radius: 8px; }
        input, textarea { width: 100%; background: #000; border: 1px solid #444; color: #00ff41; padding: 12px; margin-top: 10px; outline: none; box-sizing: border-box; }
        button { background: #00ff41; color: #000; border: none; padding: 10px 15px; cursor: pointer; font-weight: bold; margin-top: 10px; border-radius: 4px; }
        .card { background: rgba(22, 22, 22, 0.9); padding: 20px; border-radius: 8px; margin-bottom: 15px; border: 1px solid #222; }
        .user { display: flex; align-items: center; gap: 10px; margin-bottom: 10px; }
        .avatar { font-size: 25px; background: #111; border-radius: 50%; width: 40px; height: 40px; border: 1px solid #333; display: flex; align-items: center; justify-content: center; }
        .user a { color: #00ff41; font-weight: bold; text-decoration: none; }
        .reply-box { margin-top: 10px; padding-left: 15px; border-left: 2px solid #00ff41; font-size: 13px; }
    </style>
</head>
<body>

<canvas id="matrix-canvas"></canvas>

<div class="nav">
    <div class="nav-top">
        <b style="color:#00ff41">ARAKHA_FORUM</b>
        <div id="user-display" style="font-size: 12px; color: #00ff41;"></div>
        <button onclick="logout()" style="background:#ff4444; color:#fff; padding:5px 10px; font-size: 10px;">LOGOUT</button>
    </div>
</div>

<div class="container">
    <div class="post-input">
        <input type="text" id="t" placeholder="·ÄÇ·Ä±·Ä´·ÄÑ·Ä∫·Ä∏·ÄÖ·Ä≠·ÄØ·ÄÑ·Ä∫">
        <textarea id="c" rows="3" placeholder="·Ä°·ÄÄ·Äº·Ä±·Ä¨·ÄÑ·Ä∫·Ä∏·Ä°·Äõ·Ä¨..."></textarea>
        <button id="post-btn" onclick="post()">POST ·Äê·ÄÑ·Ä∫·Äô·Ä±</button>
    </div>
    <div id="feed"></div>
</div>

<script>
    // --- Matrix Animation (Optimized) ---
    const canvas = document.getElementById('matrix-canvas');
    const ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth; canvas.height = window.innerHeight;
    const matrixText = "ARAKHA010101";
    const fontSize = 16;
    const columns = canvas.width / fontSize;
    const drops = Array(Math.floor(columns)).fill(1);

    function drawMatrix() {
        ctx.fillStyle = "rgba(0, 0, 0, 0.05)";
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        ctx.fillStyle = "#00ff41";
        ctx.font = fontSize + "px monospace";
        drops.forEach((y, i) => {
            const char = matrixText[Math.floor(Math.random() * matrixText.length)];
            ctx.fillText(char, i * fontSize, y * fontSize);
            if (y * fontSize > canvas.height && Math.random() > 0.975) drops[i] = 0;
            drops[i]++;
        });
    }
    setInterval(drawMatrix, 50);

    // --- Firebase Logic ---
    const config = {
        apiKey: "AIzaSyCpIv3avDNRYNrmrzKdMqfnMdNzBGZAPow",
        authDomain: "firstarakha.firebaseapp.com",
        projectId: "firstarakha",
        databaseURL: "https://firstarakha-default-rtdb.asia-southeast1.firebasedatabase.app",
        appId: "1:4263070909:web:ef4e4a2c0891be1f49bbd4"
    };
    firebase.initializeApp(config);
    const db = firebase.database();

    let userDataCache = {}; // User data ·Äê·ÄΩ·Ä±·ÄÄ·Ä≠·ÄØ ·Äí·ÄÆ·Äë·Ä≤·Äô·Äæ·Ä¨ ·Äû·Ä≠·Äô·Ä∫·Ä∏·Äë·Ä¨·Ä∏·Äô·Äö·Ä∫

    // ·ÅÅ·Åã User data ·Ä°·Ä¨·Ä∏·Äú·ÄØ·Ä∂·Ä∏·ÄÄ·Ä≠·ÄØ ·Ä°·Äõ·ÄÑ·Ä∫·Äö·Ä∞·Äë·Ä¨·Ä∏·Äô·Äö·Ä∫
    db.ref('users').on('value', snap => {
        userDataCache = snap.val() || {};
        renderFeed(); // User data ·Äï·Äº·Ä±·Ä¨·ÄÑ·Ä∫·Ä∏·Äê·Ä≠·ÄØ·ÄÑ·Ä∫·Ä∏ Feed ·ÄÄ·Ä≠·ÄØ ·Äï·Äº·Äî·Ä∫·Äï·Äº·Äô·Äö·Ä∫
    });

    let postsData = [];
    // ·ÅÇ·Åã Post data ·Äê·ÄΩ·Ä±·ÄÄ·Ä≠·ÄØ ·Äö·Ä∞·Äô·Äö·Ä∫
    db.ref('posts').on('value', snap => {
        postsData = [];
        snap.forEach(child => { postsData.push({ key: child.key, ...child.val() }); });
        postsData.reverse(); 
        renderFeed();
    });

    // ·ÅÉ·Åã Feed ·ÄÄ·Ä≠·ÄØ ·Äë·ÄØ·Äê·Ä∫·Äï·Äº·Äê·Ä≤·Ä∑ Function (·Ä°·Äô·Äº·Äî·Ä∫·ÄÜ·ÄØ·Ä∂·Ä∏)
    function renderFeed() {
        const feed = document.getElementById('feed');
        feed.innerHTML = "";

        postsData.forEach(p => {
            const user = userDataCache[p.uid] || {};
            const name = user.username || p.u || "·Ä°·Äô·Ää·Ä∫·Äô·Äû·Ä≠";
            const avatar = user.profilePic || "üë§";

            let repliesHTML = "";
            if (p.replies) {
                Object.values(p.replies).forEach(r => {
                    const rUser = userDataCache[r.uid] || {};
                    repliesHTML += `
                        <div style="margin-top:5px;">
                            <span>${rUser.profilePic || 'üë§'}</span>
                            <a href="profile.html?id=${r.uid}" style="color:#00ff41; text-decoration:none;">@${rUser.username || r.u}:</a> ${r.m}
                        </div>`;
                });
            }

            const card = document.createElement('div');
            card.className = "card";
            card.innerHTML = `
                <div class="user">
                    <div class="avatar">${avatar}</div>
                    <a href="profile.html?id=${p.uid}">@${name}</a>
                </div>
                <div style="color:#fff; font-weight:bold;">${p.t}</div>
                <p>${p.c}</p>
                <div style="font-size:12px; color:#00ff41; cursor:pointer;" onclick="reply('${p.key}')">üí¨ Reply</div>
                <div class="reply-box">${repliesHTML}</div>
            `;
            feed.appendChild(card);
        });
    }

    async function post() {
        const t = document.getElementById('t').value, c = document.getElementById('c').value;
        const user = firebase.auth().currentUser;
        if(t && c && user) {
            db.ref("posts").push({ u: user.email.split('@')[0], uid: user.uid, t: t, c: c, time: Date.now() });
            document.getElementById('t').value = ""; document.getElementById('c').value = "";
        }
    }

    function reply(id) {
        const m = prompt("Reply ·Äï·Äº·Äî·Ä∫·Äô·Ä± -");
        const user = firebase.auth().currentUser;
        if(m && user) {
            db.ref(`posts/${id}/replies`).push({ u: user.email.split('@')[0], uid: user.uid, m: m });
        }
    }

    firebase.auth().onAuthStateChanged(user => {
        if (!user) window.location.href = "index.html";
        else document.getElementById('user-display').innerText = user.email;
    });

    function logout() { if(confirm("·Äë·ÄΩ·ÄÄ·Ä∫·Äñ·Ä≠·ÄØ·Ä∑·Äö·Ä¨·Äú·Ä¨·Ä∏?")) firebase.auth().signOut(); }
</script>
</body>
</html>
